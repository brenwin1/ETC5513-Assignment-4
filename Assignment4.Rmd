---
title: "Crime in Minneapolis"
author:
- familyname: Pi
  othernames: Lulu
  address: Monash University
  email: lpi2@student.monash.edu
  correspondingauthor: true
  qualifications: XXX
- familyname: Sheehan
  othernames: Emily
  address: Monash University
  email: eshe0012@student.monash.edu
  correspondingauthor: true
  qualifications: BComm
- familyname: Ang
  othernames: Brenwin
  address: ang0005@student.monash.edu
  qualifications: XXX
- familyname: Ye
  othernames: Chengzhi
  address: Monash University
  email: cyee0011@student.monash.edu
  correspondingauthor: true
  qualifications:  XXX
department: Faculty of \newline Business &\newline Economics
organization: Monash University
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: true
---

```{r setup}
knitr::opts_chunk$set(echo = FALSE, 
                      cache=TRUE, 
                      messages=FALSE,
                      warning=FALSE)
```

```{r libraries}
# load libraries
library(tidyverse)
library(rgdal)
library(ggrepel)
library(scales)
library(gridExtra)
library(kableExtra)
library(lubridate)
library(ggpubr)
library(RColorBrewer)
library(leaflet)
```

```{r crime-incident-data}
# read crime incident data
crime_incidents <- read_csv("data/Police_Incidents_Last_2Years.csv") 
```

```{r shapefiles-data}
# read shapefiles data
shp <- rgdal::readOGR(dsn = file.path(paste(getwd(),"/data/Police_Incidents_Last_2Years-shp", sep=""), layer = "Police_Incidents_Last_2Years.shp") , stringsAsFactors = FALSE)
```

```{r police-force-data}
# read police use of force data
police_use_of_force <- read_csv("data/Police_Use_of_Force.csv")
```

```{r clean-crime}
clean_crime <- crime_incidents %>%
  mutate(offense = case_when(
    offense %in% c("ARSON") ~ "Arson",
    offense %in% c("ASLT1",
                   "ASLT2",
                   "ASLT3",
                   "ASLT4") ~ "Assault",
    # Combining automobile theft, bike theft, coin-operated device theft, gas-station drive off, online theft, petty theft, pocket picking, scrapping-recycling theft, theft from a building, theft from a motor vehicle, theft from a person, other theft, theft by swindle, theft of motor vehicle parts
    offense %in% c("AUTOTH",
                   "MVTHFT",
                   "BIKETF",
                   "COINOP",
                   "NOPAY",
                   "ONLTHT",
                   "PETIT",
                   "POCKET",
                   "SCRAP",
                   "TBLDG",
                   "TFMV",
                   "TFPER",
                   "THEFT",
                   "THFTSW",
                   "TMVP") ~ "Theft",
    # Combining burglary of business and burglary of dwelling
    offense %in% c("BURGB",
                   "BURGD") ~ "Burglary",
    offense %in% c("ROBBIZ",
                   "ROBPAG",
                   "ROBPER") ~ "Robbery",
    offense %in% c("SHOPLF") ~ "Shoplifting",
    offense %in% c("COMPUT") ~ "Computer Hacking",
    offense %in% c("CSCR") ~ "Rape",
    # Combing first, second and third degree domestic assult with domestic assault strangulation
    offense %in% c("DASLT1",
                   "DASLT2",
                   "DASLT3",
                   "DASTR") ~ "Domestic Assault",
    offense %in% c("DISARM") ~ "Disarm a police officer",
    offense %in% c("LOOT") ~ "Looting",
    offense %in% c("MURDR") ~ "Murder")) %>%
  mutate(Year = year(enteredDate))
```

```{r cleaning data}
# prepare crime data for analysis
crime_MPLS_selected <- clean_crime %>% 
  select(reportedDate, offense, neighborhood, precinct, X, Y, description)
crime_MPLS_selected$year <- year(crime_MPLS_selected$reportedDate)
crime_MPLS_selected$month <- month(crime_MPLS_selected$reportedDate)
crime_MPLS_selected$days <- day(crime_MPLS_selected$reportedDate)

police_force_selected <- police_use_of_force %>% 
  select(ResponseDate, Problem, PrimaryOffense, ForceType, Race, Sex, TypeOfResistance ,Precinct,Neighborhood) 


police_force_selected$year <- year(police_force_selected$ResponseDate)
police_force_selected$month <- month(police_force_selected$ResponseDate)
police_force_selected$days <- day(police_force_selected$ResponseDate)

police_force_2018 <- police_force_selected %>% 
  filter(year %in% c("2018","2019", "2020"))
```

# Introduction

George Floyd was arrested and killed by Derek Chauvin, a U.S. police officer, on the 25th of May in Minneapolis, @BBC-News-2020. Chauvin knelt on George Floyd’s neck for eight minutes and 46 seconds as Floyd gasped for air.  His abominable death has sparked outrage on police brutality across America.

For several years, African-Americans have been the subject of racial vilification. In a study by @Dottolo-2008 students were interviewed and asked about police harassment and crime. Close analysis revealed that the students had stereotyped the criminals to be poor African American men. Another study by … revealed

This paper hopes to explore and understand crime in Minneapolis. Specifically, the areas where crime is most common, the ethnicity of those committing the crime, and the force used by police. 

# Data

To perform this analysis data was downloaded from the City of @Minneapolis-2020. The data obtained included the shapefiles, the crime dashboard (crime incident data) and the use of force dashboard (the use of force data). 

The crime incident data had a high number of NA's, where the race of the offender was not recorded. To mitigate the impact on the calculated proportions, particularly where race is concerned, they were not removed. Unfortunately, this considered, the analysis will still be impacted and the resulting proportions may be over or under-estimated as a result of the missing values. 

More limitations... 

# Methodology 

## Analysing the Crime Incidence

## Analysing the Neighborhoods with the Most Crime

## Analysing the Crime over Time

## Analysing the Force Used by Police

## Mapping the Use of Force Data

# Results

## Crime Incidence 

Figure \@ref(fig:plot-number-crimes) demonstrates that across all years, theft is the most commonly committed crime in Minneapolis. In this instance theft includes; automobile theft, bike theft, coin-operated device theft, gas-station drive off, online theft, petty theft, pocket picking, scrapping-recycling theft, theft from a building, theft from a motor vehicle, theft from a person, other theft, theft by swindle and theft of motor vehicle parts. Burglary and assault are the second and third highest committed crimes, respectively. It should be noted that 2019 is the only complete year, hence the higher incidence. 

```{r number-crimes}
number_crimes <- clean_crime %>%
  # group by offense and year
  group_by(offense,
           Year) %>%
  # calculate crime incidence 
  summarise(Incidence = n())
```

```{r plot-number-crimes, fig.cap= "Crime incidence according to Year and Offense Type"}
ggplot(number_crimes,
       aes(x = offense,
           y = Incidence,
           group = Year,
           # colour the plot according to offense
           fill = offense)) +
  geom_col() +
  # colour using the viridis package
  scale_fill_ordinal() +
  # split the plots according to year
  facet_wrap(~Year) +
  xlab("Type of Offense") +
  # rotate the text to enhance readability of the plot
  theme(axis.text.x = element_text(angle = 90, vjust = 0.3))
```

## Neighborhoods with the Most Crimes

Figure \@ref(fig:offencetype) captures the top five most frequent offenses in the neighborhoods with the highest crime rates. It is clear that theft is the most commonly committed crime across all neighborhoods, consistent with Figure \@ref(fig:plot-number-crimes). Comparitively, Longflow has a similar incidence of shoplifting and theft. 

```{r offencetype, fig.dim = c(6,4), fig.align="center", fig.cap="The most common offence type in the Neighborhoods with the highest Crime Incidence"}
crime_MPLS_selected %>% 
  filter(neighborhood %in% (crime_MPLS_selected  %>% count(neighborhood) %>% arrange(-n) %>% head(10) %>% pull(neighborhood)),
  offense %in% (crime_MPLS_selected  %>% count(offense) %>% arrange(-n) %>% head(5) %>% pull(offense))) %>% 
    ggplot(aes(neighborhood, fill = offense))+
    geom_bar(position = "fill")+
    scale_fill_ordinal()+
    coord_flip()
```

```{r neighborhood-2018}
neighborhood_summary <- clean_crime %>% select(precinct,
                                                reportedDate,
                                                neighborhood)
neighborhood_summary$year <- year(neighborhood_summary$reportedDate)


neighborhood_summary2018 <- neighborhood_summary %>%
  dplyr::filter(year %in% c("2018")) %>%
  group_by(neighborhood) %>%
  summarise(case = n()) %>%
  distinct() %>%
  top_n(20)

kable(neighborhood_summary2018, caption = "Top 20 Neighborhoods with the Highest Crime Rate for 2018") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r neighborhood-2019}
neighborhood_summary2019 <- neighborhood_summary %>%
  dplyr::filter(year %in% c("2019")) %>%
  group_by(neighborhood) %>%
  summarise(case = n()) %>%
  distinct() %>%
  top_n(20)

kable(neighborhood_summary2019, caption = "Top 20 Neighborhoods with the Highest Crime Rate for 2019") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r neighborhood-2020}
neighborhood_summary2020 <- neighborhood_summary %>%
  dplyr::filter(year %in% c("2020")) %>%
  group_by(neighborhood) %>%
  summarise(case = n()) %>%
  distinct() %>%
  top_n(20)

kable(neighborhood_summary2020, caption = "Top 20 Neighborhoods with the Highest Crime Rate for 2020") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r neighborhood2018, fig.dim = c(6,4), fig.cap= "Top 20 Neighborhoods with the Highest Crime Rate for 2018"}
neighborhood_summary2018 %>%
  ggplot(aes(reorder(neighborhood, case), y = case)) +
  geom_col(fill = "yellow") +
  geom_label_repel(aes(label = case), size = 2.5) +
  coord_flip() +
  labs(x = "Neighborhood", 
       y = "Incidence")
```

```{r neighborhood2019, fig.dim = c(6,4), fig.cap = "Top 20 Neighborhoods with the Highest Crime Rate for 2019"}
neighborhood_summary2019 %>%
  ggplot(aes(reorder(neighborhood, case), y = case)) +
  geom_col(fill = "midnight blue") +
  geom_label_repel(aes(label = case), size = 2.5) +
  coord_flip() +
  labs(x = "Neighborhood", 
       y = "Incidence")
```

```{r neighborhood2020, fig.dim = c(6,4), fig.cap = "Top 20 Neighborhoods with the Highest Crime Rate for 2020"}
neighborhood_summary2020 %>%
  ggplot(aes(reorder(neighborhood, case), y = case)) +
  geom_col(fill = "light green") +
  geom_label_repel(aes(label = case), size = 2.5) +
  coord_flip() +
  labs(x = "Neighborhood", 
       y = "Incidence")
```

Figure \@ref(fig:neighborhood2018), Figure \@ref(fig:neighborhood2019) and Figure \@ref(fig:neighborhood2020), show that across all years **Downtown West** and **Whittier** have the highest crime rate, followed by **Longfellow**, **Lowry Hill East** and **Marcy Holmes**. 

Figure \@ref(fig:Crimeanalysis) explores the relationship between precinct and offense type. Across all precincts, theft is the most commonly committed crime, consistent with Figure \@ref(fig:plot-number-crimes). Interestingly enough, precinct 1 and 2 have a similar incidence of theft, however, precinct 5 has a much higher incidence of bulglary. 

```{r Crimeanalysis, fig.align="center", fig.width= 8, fig.cap="Crimes comparison of different districts"}
crime_MPLS_selected %>% filter(offense %in% 
                                 (crime_MPLS_selected 
                                  %>% count(offense) %>%
                                  arrange(-n) %>%
                                  # use top ten offenses only
                                  head(10) 
                                  %>% pull(offense))) %>% 
    ggplot(aes(precinct, 
               fill = offense))+
    geom_bar()+
  # swap the x and y axis
    coord_flip()+
   # colour using the viridis package
    scale_fill_ordinal()
```

## Crime over Time 

Figure \@ref(fig:timefig) compares the incidence of crimes in each month. As stated above, 2019 is the only complete year in the data set. In 2018, crime peaked in October, and dropped in December. In 2019, crime was very low in the colder months (January, February and March), peaking in the summer months (July and August). Comparitively, the incidence of crime in 2020 was much lower than 2019 and did not increase in May, which is likely due to the stay at home orders resulting from COVID-19. 

```{r timefig, fig.align="center", fig.width= 8, fig.cap="Comparison of crimes in different months"}
crime_MPLS_month_2018 <- crime_MPLS_selected %>%
  # filter according to year
  filter(year == 2018) %>% 
  select(year, month) %>% 
  # group by year
  group_by(year) %>% 
  count(month) 
p1 <-   ggplot(crime_MPLS_month_2018, 
        aes(x=as.factor(month), y=n)) + 
  # fill with red
        geom_bar(stat='identity', fill="light green") +
        scale_y_continuous(labels=comma, limits = c(0, 2000)) + 
  # facet according to year
        facet_grid(.~year) + 
  # label x and y axis
        labs(x='Month', y='Number of incidents')

crime_MPLS_month_2019 <- crime_MPLS_selected %>%
  # filter according to year
  filter(year == 2019) %>% 
  select(year, month) %>% 
  # group by year
  group_by(year) %>% 
  count(month) 
p2 <-   ggplot(crime_MPLS_month_2019, 
        aes(x=as.factor(month), y=n)) + 
  # fill with red
        geom_bar(stat='identity', fill="light green") +
        scale_y_continuous(labels=comma) + 
  # facet according to year
        facet_grid(.~year) + 
  # label x and y axis
        labs(x='Month', y='Number of incidents')

crime_MPLS_month_2020 <- crime_MPLS_selected %>%
  # filter according to year
  filter(year == 2020) %>% 
  select(year, month) %>%
  # group by year
  group_by(year) %>% 
  count(month) 
p3 <-  ggplot(crime_MPLS_month_2020, 
          aes(x=as.factor(month), y=n)) + 
  # fill with red
          geom_bar(stat='identity', fill="light green") +
          scale_y_continuous(labels=comma, limits = c(0, 2000)) + 
  # facet according to year
          facet_grid(.~year) + 
  # label x and y axis
          labs(x='Month', y='Number of incidents')

# arrange the plots so they are displayed as one plot
grid.arrange(p1, p2, p3, ncol = 3)
```

## Force Used by Police Data

Figure \@ref(fig:weekdaysituation) show the distribution of crime and force used over a given week. There are more crimes on weekdays than on weekends, however, the force use by police is the opposite with greater force use on weekends. It is likely that weekends will attract larger crowds, particularly at entertainment venues, therefore attracting a larger police presence. Furthermore, it is unlikely criminals will commit crimes, particularly when police presence is so high. 

```{r weekdaysituation, fig.align="center", fig.width= 8, fig.cap="The average crimes and force using in a week"}
crime_MPLS_selected$weekday <- wday(crime_MPLS_selected$reportedDate, label=TRUE)
police_force_2018$weekday <- wday(police_force_2018$ResponseDate, label=TRUE)

w1 <- crime_MPLS_selected %>% 
        count(weekday) %>%
          ggplot(aes(x=weekday, y=n)) + 
          geom_bar(stat='identity', fill="midnight blue") +
          scale_y_continuous(labels=comma) +
          labs(x='Weekday', y='Number of incidents', title='Incidents in each day')

w2 <- police_force_2018 %>% 
        count(weekday) %>%
          ggplot(aes(x=weekday, y=n)) + 
          geom_bar(stat='identity', fill="yellow") +
          scale_y_continuous(labels=comma) +
          labs(x='Weekday', y='Number of using force', title='force using in each day')

grid.arrange(w1, w2, ncol = 2)
```

Figure \@ref(fig:TypeOfResistance) shows the resistance used in each precinct. In essence, this figure captures the prevalance of crime and perhaps the effiency of police in controlling the crime rate. It can be inferred that the fourth precinct is significantly more dangerous than the fifth precinct, and the force use in the fourth precinct is much higher. 

```{r TypeOfResistance, fig.align="center", fig.width= 8, fig.cap="The different Resistance of criminals in each Precinct"}
police_force_selected %>% 
  filter(TypeOfResistance %in% (police_force_selected  %>% count(TypeOfResistance) %>% arrange(-n) %>% head(9) %>% pull(TypeOfResistance)),
  Precinct %in% (police_force_selected  %>% count(Precinct) %>% arrange(-n) %>% head(5) %>%  pull(Precinct))) %>% 
    ggplot(aes(TypeOfResistance, fill = Precinct))+
    geom_bar(position = "fill")+
    ggtitle("The Different Type Of Resistance in Each Precinct")+
    scale_colour_gradientn(colours=rainbow(5))+
    coord_flip()
```

Figure \@ref(fig:relationshipfig) shows the relationship between the force type and the type of resistance. This figure captures the effectiveness of the force type used by police. If the only resistance used by police is a dog, criminals are more likely to flee on foot. However, if a firearm or chemical irritant is used, criminals are less likely to escape.  

```{r relationshipfig, fig.align="center", fig.width= 8, fig.cap="The relationship between Force Type adopted by police and type of resistance of criminals"}

police_force_selected %>% 
  filter(TypeOfResistance %in% (police_force_selected  %>% count(TypeOfResistance) %>% arrange(-n) %>% head(5) %>% pull(TypeOfResistance)),
  ForceType %in% (police_force_selected  %>% count(ForceType) %>% arrange(-n) %>% head(10) %>% pull(ForceType))) %>% 
    ggplot(aes(ForceType, fill = TypeOfResistance))+
    geom_bar(position = "fill")+
    ggtitle("The relationship between force type and type of resistance")+
    scale_fill_ordinal()+
    coord_flip()
```

Figure \@ref(fig:Race) shows the use of force, according to race. It is clear that African Americans are subject to more aggressive forms of force. Further, the figure demonstrates police are less likely to use less lethal force on African Americans.

```{r Race, fig.align="center", fig.width= 8, fig.cap="Different races are treated differently"}
police_force_selected %>% 
  filter(Race %in% (police_force_selected  %>% count(Race) %>% arrange(-n) %>% head(3) %>% pull(Race)),
  ForceType %in% (police_force_selected  %>% count(ForceType) %>% arrange(-n)  %>%  pull(ForceType))) %>% 
    ggplot(aes(ForceType, fill = Race))+
    geom_bar(position = "fill")+
    ggtitle("Use of Force Type toward Different Race")+
    scale_colour_gradientn(colours=rainbow(5))+
    coord_flip()
```

\clearpage

# Police use of force map analysis

```{r puofbar, fig.cap = "proportion of race in police use of force by Precincts"}
police_use_of_force %>% 
  ggplot(aes(x = Race)) +
  geom_bar(aes(y = stat(prop),
               group = 1)) +
  facet_wrap(~Precinct) +
  coord_flip()
```

Dataset comes from @openmn
**Figure \@ref(fig:puofbar)** shows the proportion of race in police use of force by Precincts.

> WIP: need to join table with demographics (racial composition in each Precinct) and data on proportion of crimes commited by race in each precinct.

## Police use of force map
```{r}
library(leaflet)
library(rgdal)

# read in shape file
shp <- rgdal::readOGR(dsn = file.path(paste(getwd(),"/data/Police_Use_of_Force-shp", sep=""), layer = "Police_Use_of_Force.shp") , stringsAsFactors = FALSE)
```

```{r}
library(sf)
# Read shp file into a data frame
shp_sf1 <- st_read(dsn = file.path(paste(getwd(),"/data/Police_Use_of_Force-shp/Police_Use_of_Force.shp", sep=""))) %>% 
  filter(CenterLati != 0)
```

```{r puofmap, fig.cap = "Number of police use of force incidents in Precincts", fig.align = "center"}
shp_sf1 %>% 
  leaflet() %>% 
  addTiles() %>% 
  # Add Circle Markers 
  addCircleMarkers(lng = shp_sf1$CenterLong, 
             lat = shp_sf1$CenterLati, 
             clusterOptions = markerClusterOptions()) # cluster circles and prevent hanging!
```

**Figure \@ref(fig:puofmap)** shows the police use of force map in Minneapolis. The numbers show number of incidents per precinct. 

## Precincts
```{r}
# mapping points where police use of force were recorded. 
shp_sf1 %>% 
  ggplot() +
  geom_sf(aes(colour = Precinct)) # colour points by precincts
```



