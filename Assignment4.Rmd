---
title: "Crime in Minneapolis"
author:
- familyname: XXXX
  othernames: XXX
  address: Monash Universtidy
  email: XXX
  correspondingauthor: true
  qualifications:  XXX
- familyname: XXXX
  othernames: Reports
  address: XXX
  qualifications: XXX
- familyname: XXX
  othernames: XXX
  address: XXX
  email: XXX
  correspondingauthor: true
  qualifications:  XXX
department: Our consultancy \newline add names &\newline add names
organization: Australian Government COVID19
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: true
---

Analysis of Crime in Minneapolis:

* What types of crimes are most common?
* What crime is committed by each race? Are they proportionate?
* What are the most common force types?
* Which months of the year have the most criminal records?
* Which day of the week has the most crimes or forces used by police?
* Which area has the most crime?
* Is it the same police committing each crime?

```{r setup}
knitr::opts_chunk$set(echo = FALSE, 
                      cache=TRUE, 
                      messages=FALSE,
                      warning=FALSE)
```

```{r libraries, include = FALSE}
library(tidyverse)
library(rgdal)
library(ggrepel)
library(scales)
library(gridExtra)
library(kableExtra)
library(lubridate)
library(ggpubr)
library(RColorBrewer)
library(leaflet)
```

```{r crime-incident-data}
crime_incidents <- read_csv("data/Police_Incidents_Last_2Years.csv") 

```

```{r shapefiles-data}
shp <- rgdal::readOGR(dsn = file.path(paste(getwd(),"/data/Police_Incidents_Last_2Years-shp", sep=""), layer = "Police_Incidents_Last_2Years.shp") , stringsAsFactors = FALSE)
```

```{r police-force-data}
police_use_of_force <- read_csv("data/Police_Use_of_Force.csv")
```

```{r police-stop-data, eval = FALSE}
police_stop_data <- read_csv("data/Police_Stop_Data.csv")
```

# Introduction

George Floyd was arrested and killed by Derek Chauvin, a U.S. police officer, on the 25th of May in Minneapolis, @BBC-News-2020. Chauvin knelt on George Floyd’s neck for eight minutes and 46 seconds as Floyd gasped for air.  His abominable death has sparked outrage on police brutality across America.

For several years, African-Americans have been the subject of racial vilification. In a study by @Dottolo-2008 students were interviewed and asked about police harassment and crime. Close analysis revealed that the students had stereotyped the criminals to be poor African American men. Another study by … revealed

This paper hopes to explore and understand crime in Minneapolis. Specifically, the areas where crime is most common, the ethnicity of those committing the crime, and the force used by police. 

# Data

To perform this analysis 

# Methodology 

## Analysing the crime which is most common 

The crime incidence data was wrangled. This involved assigning each crime to its relevant offence type. The incidence of each offense was calculated, and plotted according to year.


## Analysing the crime being committed by each race
number_crimes


## Computing the most common force type


The police use of force data was wrangled, and a summary was generated to count the incidence of each offense according to race. The data was plotted. 

## Analysing the months of the year which have the most criminal records

## Analysing the areas that have the most crime 

## Analysing whether Police are repeat offenders?


# Results

## Depth analysis on crime

To make the division of crime distribution more detailed, I used Neighborhood instead of Precinct, but due to the quite large number, I only took Top10 neighborhood with the highest crimes and the Top5 most frequent offenses(See Figure \@ref(fig:offencetype)).
It is obvious that basically in each neighborhood, theft is still the most frequent occurrence. But Longflow is the only exception, shoplifting is about to reach the number of theft.

```{r offencetype, fig.align="center", fig.width= 8, fig.cap="The most common offence type in Top_10 Neighborhoods with the most crimes"}
crime_MPLS_selected %>% 
  filter(neighborhood %in% (crime_MPLS_selected  %>% count(neighborhood) %>% arrange(-n) %>% head(10) %>% pull(neighborhood)),
  offense %in% (crime_MPLS_selected  %>% count(offense) %>% arrange(-n) %>% head(5) %>% pull(offense))) %>% 
    ggplot(aes(neighborhood, fill = offense))+
    geom_bar(position = "fill")+
    ggtitle("The Offence Type in Top 10 neighbourhoods")+
    scale_fill_ordinal()+
    coord_flip()
```


```{r neighborhood-2018}
neighborhood_summary <- clean_crime %>% select(precinct,
                                                reportedDate,
                                                neighborhood)
neighborhood_summary$year <- year(neighborhood_summary$reportedDate)


neighborhood_summary2018 <- neighborhood_summary %>%
  dplyr::filter(year %in% c("2018")) %>%
  group_by(neighborhood) %>%
  summarise(case = n()) %>%
  distinct() %>%
  top_n(20)

kable(neighborhood_summary2018, caption = "top 20 neighborhood with most cases in 2018") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r neighborhood-2019}
neighborhood_summary2019 <- neighborhood_summary %>%
  dplyr::filter(year %in% c("2019")) %>%
  group_by(neighborhood) %>%
  summarise(case = n()) %>%
  distinct() %>%
  top_n(20)

kable(neighborhood_summary2019, caption = "top 20 neighborhood with most cases in 2019") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r neighborhood-2020}
neighborhood_summary2020 <- neighborhood_summary %>%
  dplyr::filter(year %in% c("2020")) %>%
  group_by(neighborhood) %>%
  summarise(case = n()) %>%
  distinct() %>%
  top_n(20)

kable(neighborhood_summary2020, caption = "top 20 neighborhood with most cases in 2020") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r neighborhood2018}
neighborhood_summary2018 %>%
  ggplot(aes(reorder(neighborhood, case), y = case)) +
  geom_col(fill = "red") +
  geom_label_repel(aes(label = case), size = 2.5) +
  coord_flip() +
  labs(title = "top 20 neighborhood with most cases in 2018", 
       x = "neighborhood", 
       y = "case")
```

```{r neighborhood2019}
neighborhood_summary2019 %>%
  ggplot(aes(reorder(neighborhood, case), y = case)) +
  geom_col(fill = "blue") +
  geom_label_repel(aes(label = case), size = 2.5) +
  coord_flip() +
  labs(title = "top 20 neighborhood with most cases in 2019", 
       x = "neighborhood", 
       y = "case")
```

```{r neighborhood2020}
neighborhood_summary2020 %>%
  ggplot(aes(reorder(neighborhood, case), y = case)) +
  geom_col(fill = "green") +
  geom_label_repel(aes(label = case), size = 2.5) +
  coord_flip() +
  labs(title = "top 20 neighborhood with most cases in 2020", 
       x = "neighborhood", 
       y = "case")

```

As in  Figure\@ref(fig:neighborhood2018), Figure\@ref(fig:neighborhood2019) and Figure\@ref(fig:neighborhood2020), **Downtown West** and **Whittier** always be the top areas with the most cases, the following areas would be **Longfellow**, **Lowry Hill East** and **Marcy Holmes** in each year. 

The precinct with the most cases contributed to precinct 3 in three years, as shown in the Figure\@ref(fig:precinct), while the top 2 neigorborhoods located in precinct 1 and 5. There should be more force transferred to the related precinct if it is necessary, and prepare efficient and effective resistance to the neighborhood with most cases as soon as possible. 

The most reason for force used in 2018, 2019 and 2020 is **ASLT4** as shown in Figure\@ref(fig:force used for primary offense), which means the offense is less than substantive harm. The safety of polices when they use of force is need to be paid attention as well. According to Figure\@ref(fig:resistant type), polices would provide resistant mostly with **tensed** cases, typically when people experienced anxiety or nervousness. Chasing crimes with cases when **fled on foot**, or dealing with **assaulted Officers** are the common tasks they faced every day no matter in which year. Therefore, polices would use **bodily force** in more than 70% cases as in Figure\@ref(fig:force type), the following would be using **chemical irritant**, and they actually would use gun in rare cases. However, they still got injured in approximately 52% cases according to the recorded data we have in 2018 and 2019 with Figure\@ref(fig:injury condition), since they take punches, kicks, Body Weight to pin and joint lock, related protection tools should be prepared to them and regularly training as well if possible. 


## Crime incident Data

Figure \@ref(fig:plot-number-crimes) demonstrates that across all years, theft is the most commonly committed crime in Minneapolis. In this instance theft includes; automobile theft, bike theft, coin-operated device theft, gas-station drive off, online theft, petty theft, pocket picking, scrapping-recycling theft, theft from a building, theft from a motor vehicle, theft from a person, other theft, theft by swindle and theft of motor vehicle parts. 

```{r clean-crime}
clean_crime <- crime_incidents %>%
  mutate(offense = case_when(
    offense %in% c("ARSON") ~ "Arson",
    offense %in% c("ASLT1",
                   "ASLT2",
                   "ASLT3",
                   "ASLT4") ~ "Assault",
    # Combining automobile theft, bike theft, coin-operated device theft, gas-station drive off, online theft, petty theft, pocket picking, scrapping-recycling theft, theft from a building, theft from a motor vehicle, theft from a person, other theft, theft by swindle, theft of motor vehicle parts
    offense %in% c("AUTOTH",
                   "MVTHFT",
                   "BIKETF",
                   "COINOP",
                   "NOPAY",
                   "ONLTHT",
                   "PETIT",
                   "POCKET",
                   "SCRAP",
                   "TBLDG",
                   "TFMV",
                   "TFPER",
                   "THEFT",
                   "THFTSW",
                   "TMVP") ~ "Theft",
    # Combining burglary of business and burglary of dwelling
    offense %in% c("BURGB",
                   "BURGD") ~ "Burglary",
    offense %in% c("ROBBIZ",
                   "ROBPAG",
                   "ROBPER") ~ "Robbery",
    offense %in% c("SHOPLF") ~ "Shoplifting",
    offense %in% c("COMPUT") ~ "Computer Hacking",
    offense %in% c("CSCR") ~ "Rape",
    # Combing first, second and third degree domestic assult with domestic assault strangulation
    offense %in% c("DASLT1",
                   "DASLT2",
                   "DASLT3",
                   "DASTR") ~ "Domestic Assault",
    offense %in% c("DISARM") ~ "Disarm a police officer",
    offense %in% c("LOOT") ~ "Looting",
    offense %in% c("MURDR") ~ "Murder")) %>%
  mutate(Year = year(enteredDate))
```

```{r cleaning data}
crime_MPLS_selected <- clean_crime %>% 
  select(reportedDate, offense, neighborhood, precinct, X, Y, description)
crime_MPLS_selected$year <- year(crime_MPLS_selected$reportedDate)
crime_MPLS_selected$month <- month(crime_MPLS_selected$reportedDate)
crime_MPLS_selected$days <- day(crime_MPLS_selected$reportedDate)

police_force_selected <- police_use_of_force %>% 
  select(ResponseDate, Problem, PrimaryOffense, ForceType, Race, Sex, TypeOfResistance ,Precinct,Neighborhood) 


police_force_selected$year <- year(police_force_selected$ResponseDate)
police_force_selected$month <- month(police_force_selected$ResponseDate)
police_force_selected$days <- day(police_force_selected$ResponseDate)

police_force_2018 <- police_force_selected %>% 
  filter(year %in% c("2018","2019", "2020"))
```

```{r number-crimes}
number_crimes <- clean_crime %>%
  group_by(offense,
           Year) %>%
  summarise(Incidence = n())
```

```{r plot-number-crimes}
ggplot(number_crimes,
       aes(x = offense,
           y = Incidence,
           group = Year)) +
  geom_col() +
  facet_wrap(~Year) +
  xlab("Type of Offense") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.3))
```

```{r Crimeanalysis, fig.align="center", fig.width= 8, fig.cap="Crimes comparison of different districts"}
crime_MPLS_selected %>% filter(offense %in% (crime_MPLS_selected  %>% count(offense) %>% arrange(-n) %>% head(10) %>% pull(offense))) %>% 
    ggplot(aes(precinct, fill = offense))+
    geom_bar()+
    coord_flip()+
    scale_fill_ordinal()
```

## Crime with time

The part I am responsible for mainly includes the relationship between different time and precinct with crime. 
The first figure shows the total number of crimes in each month from 2018 to 2020, from which we can see that crimes soared from May, peaked in July and August, and then gradually began to decline(See Figure \@ref(fig:timefig)). If we compare different years, 2018 is significantly safer than 2019. As for 2020, compared with the May of previous year, the number of crimes did not increase but decrease, which is probably due to COVID19.

```{r timefig, fig.align="center", fig.width= 8, fig.cap="Comparison of crimes in different months"}
crime_MPLS_month_2018 <- crime_MPLS_selected %>%
  filter(year == 2018) %>% 
  select(year, month) %>% 
  group_by(year) %>% 
  count(month) 
p1 <-   ggplot(crime_MPLS_month_2018, 
        aes(x=as.factor(month), y=n)) + 
        geom_bar(stat='identity', fill='red') +
        scale_y_continuous(labels=comma, limits = c(0, 2000)) + 
        facet_grid(.~year) + 
        labs(x='Month', y='Number of incidents')

crime_MPLS_month_2019 <- crime_MPLS_selected %>%
  filter(year == 2019) %>% 
  select(year, month) %>% 
  group_by(year) %>% 
  count(month) 
p2 <-   ggplot(crime_MPLS_month_2019, 
        aes(x=as.factor(month), y=n)) + 
        geom_bar(stat='identity', fill='red') +
        scale_y_continuous(labels=comma) + 
        facet_grid(.~year) + 
        labs(x='Month', y='Number of incidents')

crime_MPLS_month_2020 <- crime_MPLS_selected %>%
  filter(year == 2020) %>% 
  select(year, month) %>% 
  group_by(year) %>% 
  count(month) 
p3 <-  ggplot(crime_MPLS_month_2020, 
          aes(x=as.factor(month), y=n)) + 
          geom_bar(stat='identity', fill='red') +
          scale_y_continuous(labels=comma, limits = c(0, 2000)) + 
          facet_grid(.~year) + 
          labs(x='Month', y='Number of incidents')


grid.arrange(p1, p2, p3, ncol = 3)
```

## Force Used By Police Data

The following figures show the distribution of crimes and force using every day. It can be seen that there are more crimes on weekdays than on weekends, but the situation of force using by police is just the opposite. It is possible that most people will go to recreation places on weekends, and too many people gather will lead to conflicts, so the times of patrol by police will stay high. And criminals will not commit crimes when there are so many police (See Figure \@ref(fig:weekdaysituation)). 

```{r weekdaysituation, fig.align="center", fig.width= 8, fig.cap="The average crimes and force using in a week"}
crime_MPLS_selected$weekday <- wday(crime_MPLS_selected$reportedDate, label=TRUE)
police_force_2018$weekday <- wday(police_force_2018$ResponseDate, label=TRUE)

w1 <- crime_MPLS_selected %>% 
        count(weekday) %>%
          ggplot(aes(x=weekday, y=n)) + 
          geom_bar(stat='identity', fill='red') +
          scale_y_continuous(labels=comma) +
          labs(x='Weekday', y='Number of incidents', title='Incidents in each day')

w2 <- police_force_2018 %>% 
        count(weekday) %>%
          ggplot(aes(x=weekday, y=n)) + 
          geom_bar(stat='identity', fill='red') +
          scale_y_continuous(labels=comma) +
          labs(x='Weekday', y='Number of using force', title='force using in each day')

grid.arrange(w1, w2, ncol = 2)
```

The last three figures are about the data of force using by police. 
Figure \@ref(fig:TypeOfResistance) shows The Different Type of Resistance in Each Precinct. In a sense, it can be seen that the efficiency of the police and the risk of criminals in each precinct. For example, No. 4 precinct is significantly more dangerous than No. 1 precinct, the probability of criminals escaping is greatly increased, while the Commission of crime is too low to be frightening. 

```{r TypeOfResistance, fig.align="center", fig.width= 8, fig.cap="The different Resistance of criminals in each Precinct"}
police_force_selected %>% 
  filter(TypeOfResistance %in% (police_force_selected  %>% count(TypeOfResistance) %>% arrange(-n) %>% head(9) %>% pull(TypeOfResistance)),
  Precinct %in% (police_force_selected  %>% count(Precinct) %>% arrange(-n) %>% head(5) %>%  pull(Precinct))) %>% 
    ggplot(aes(TypeOfResistance, fill = Precinct))+
    geom_bar(position = "fill")+
    ggtitle("The Different Type Of Resistance in Each Precinct")+
    scale_colour_gradientn(colours=rainbow(5))+
    coord_flip()
```

Figure \@ref(fig:relationshipfig) shows the relationship between the force type and the type of resistance. The purpose of this figure is to show the effect of the force type used by the police when treating the criminals. I think the content in that figure is obvious, for example, if only using the police dog, the effect is not good and the criminals are easy to escape. If firearm and chemical irritant are combined, better results will be achieved.

```{r relationshipfig, fig.align="center", fig.width= 8, fig.cap="The relationship between Force Type adopted by police and type of resistance of criminals"}

police_force_selected %>% 
  filter(TypeOfResistance %in% (police_force_selected  %>% count(TypeOfResistance) %>% arrange(-n) %>% head(5) %>% pull(TypeOfResistance)),
  ForceType %in% (police_force_selected  %>% count(ForceType) %>% arrange(-n) %>% head(10) %>% pull(ForceType))) %>% 
    ggplot(aes(ForceType, fill = TypeOfResistance))+
    geom_bar(position = "fill")+
    ggtitle("The relationship between force type and type of resistance")+
    scale_fill_ordinal()+
    coord_flip()
```

The last one is the proportion of different Race in the use of force.(See Figure \@ref(fig:Race)) This is a sensitive topic, but it is clear that without the influence of NA, only when police use the less lethal related way to deal with criminals then the incidences of black people will be significantly reduced, otherwise black people accounted for more than 70% in the rest of the various use of force. Our group is not clear about the situation on the ground in Minneapolis, nor clear about other things about black people. Only from this figure alone, is the way the police treat black people too radical?

```{r Race, fig.align="center", fig.width= 8, fig.cap="Different races are treated differently"}
police_force_selected %>% 
  filter(Race %in% (police_force_selected  %>% count(Race) %>% arrange(-n) %>% head(3) %>% pull(Race)),
  ForceType %in% (police_force_selected  %>% count(ForceType) %>% arrange(-n)  %>%  pull(ForceType))) %>% 
    ggplot(aes(ForceType, fill = Race))+
    geom_bar(position = "fill")+
    ggtitle("Use of Force Type toward Different Race")+
    scale_colour_gradientn(colours=rainbow(5))+
    coord_flip()
```

## Mapping the the Use of Police Force

```{r}
library(leaflet)
library(rgdal)

shp <- rgdal::readOGR(dsn = file.path(paste(getwd(),"/data/Police_Use_of_Force-shp", sep=""), layer = "Police_Use_of_Force.shp") , stringsAsFactors = FALSE)

head(shp@data)
summary(shp@data)
head(shp@data)
```

# Police use of force map
```{r}
library(sf)
# Read shp file into a data frame
shp_sf1 <- st_read(dsn = file.path(paste(getwd(),"/data/Police_Use_of_Force-shp/Police_Use_of_Force.shp", sep=""))) %>% 
  filter(CenterLati != 0)
```

```{r}
shp_sf1 %>% 
  leaflet() %>% 
  addTiles() %>% 
  # Add Circle Markers 
  addCircleMarkers(lng = shp_sf1$CenterLong, 
             lat = shp_sf1$CenterLati, 
             clusterOptions = markerClusterOptions()) # cluster circles and prevent hanging!


# xxxxx potentially; group and label markers (by race and neighbourhood)
# xxxxx change tile to Google maps (more familiar )
```

## Analysis of the neighborhood data

These next figures are made by ggplot2 and scale_fill_ ordinal, to show the relationship between crime and various factors more clearly. This figure shows the total number of crimes per precinct between 2018 and 2020(See Figure \@ref(fig:Crimeanalysis)). No. 3 precinct has the highest number of crimes, while No. 2 precinct has the lowest number of crimes, which is relatively safe. It can be seen from the above that theft accounts for the highest proportion of all precinct crimes, while burglary and robbery are closely followed, ranking second and third respectively.





