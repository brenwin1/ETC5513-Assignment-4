---
title: "Crime in Minneapolis"
author: "ETC5513 Group 6"
date: "30/05/2020"
output: html_document
---

Minneapolis has the highest violent crime rate in the US. 

Research Questions (If anyone thinks of more, please add!!) 
- Where is crime most common in Minneapolis?
Heat map
- What is the ethnicity of those who are commmitting the crimes? 
Major crimes/minor crimes
- Where is force used?
Heat Map 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries}
library(tidyverse)
library(rgdal)
library(lubridate)
library(ggrepel)
library(scales)
library(gridExtra)
library(kableExtra)
```

```{r}
crime_incidents <- read_csv("data/Police_Incidents_Last_2Years.csv") 

glimpse(crime_incidents)
```

```{r}
shp <- rgdal::readOGR(dsn = file.path(paste(getwd(),"/data/Police_Incidents_Last_2Years-shp", sep=""), layer = "Police_Incidents_Last_2Years.shp") , stringsAsFactors = FALSE)

summary(shp@data)
```

```{r}
police_use_of_force <- read_csv("data/Police_Use_of_Force.csv")
```

```{r}
police_stop_data <- read_csv("data/Police_Stop_Data.csv")
```

What is the ethnicity of those who are commmitting the crimes? 

```{r}
crime_incidents %>%
  group_by(offense) %>%
  summarise(unique(offense))
```

```{r clean-crime}
clean_crime <- crime_incidents %>%
  mutate(offense = case_when(
    offense %in% c("ARSON") ~ "Arson",
    offense %in% c("ASLT1",
                   "ASLT2",
                   "ASLT3",
                   "ASLT4") ~ "Assault",
    # Combining automobile theft, bike theft, coin-operated device theft, gas-station drive off, online theft, petty theft, pocket picking, scrapping-recycling theft, theft from a building, theft from a motor vehicle, theft from a person, other theft, theft by swindle, theft of motor vehicle parts
    offense %in% c("AUTOTH",
                   "MVTHFT",
                   "BIKETF",
                   "COINOP",
                   "NOPAY",
                   "ONLTHT",
                   "PETIT",
                   "POCKET",
                   "SCRAP",
                   "TBLDG",
                   "TFMV",
                   "TFPER",
                   "THEFT",
                   "THFTSW",
                   "TMVP") ~ "Theft",
    # Combining burglary of business and burglary of dwelling
    offense %in% c("BURGB",
                   "BURGD") ~ "Burglary",
    offense %in% c("ROBBIZ",
                   "ROBPAG",
                   "ROBPER") ~ "Robbery",
    offense %in% c("SHOPLF") ~ "Shoplifting",
    offense %in% c("COMPUT") ~ "Computer Hacking",
    offense %in% c("CSCR") ~ "Rape",
    # Combing first, second and third degree domestic assult with domestic assault strangulation
    offense %in% c("DASLT1",
                   "DASLT2",
                   "DASLT3",
                   "DASTR") ~ "Domestic Assault",
    offense %in% c("DISARM") ~ "Disarm a police officer",
    offense %in% c("LOOT") ~ "Looting",
    offense %in% c("MURDR") ~ "Murder"))

clean_crime
```



```{r neighbourhood2018}
neighborhood_summary <- clean_crime %>% select(precinct,
                                                reportedDate,
                                                neighborhood)
neighborhood_summary$year <- year(neighborhood_summary$reportedDate)

neighborhood_summary2018 <- neighborhood_summary %>%
  dplyr::filter(year %in% c("2018")) %>%
  group_by(neighborhood) %>%
  summarise(case = n()) %>%
  distinct() %>%
  top_n(20)

kable(neighborhood_summary2018, caption = "top 20 neighborhood with most cases in 2018") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r neighborhood2019}
neighborhood_summary2019 <- neighborhood_summary %>%
  dplyr::filter(year %in% c("2019")) %>%
  group_by(neighborhood) %>%
  summarise(case = n()) %>%
  distinct() %>%
  top_n(20)

kable(neighborhood_summary2019, caption = "top 20 neighborhood with most cases in 2019") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r neighborhood2020}
neighborhood_summary2020 <- neighborhood_summary %>%
  dplyr::filter(year %in% c("2020")) %>%
  group_by(neighborhood) %>%
  summarise(case = n()) %>%
  distinct() %>%
  top_n(20)

kable(neighborhood_summary2020, caption = "top 20 neighborhood with most cases in 2020") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

```{r}
neighborhood_summary2018 %>%
  ggplot(aes(reorder(neighborhood, case), y = case)) +
  geom_col(fill = "red") +
  geom_label_repel(aes(label = case), size = 2.5) +
  coord_flip() +
  labs(title = "top 20 neighborhood with most cases in 2018", 
       x = "neighborhood", 
       y = "case")
```

```{r}
neighborhood_summary2019 %>%
  ggplot(aes(reorder(neighborhood, case), y = case)) +
  geom_col(fill = "blue") +
  geom_label_repel(aes(label = case), size = 2.5) +
  coord_flip() +
  labs(title = "top 20 neighborhood with most cases in 2019", 
       x = "neighborhood", 
       y = "case")
```

```{r}
neighborhood_summary2020 %>%
  ggplot(aes(reorder(neighborhood, case), y = case)) +
  geom_col(fill = "green") +
  geom_label_repel(aes(label = case), size = 2.5) +
  coord_flip() +
  labs(title = "top 20 neighborhood with most cases in 2020", 
       x = "neighborhood", 
       y = "case")

```

```{r}
precinct_summary <- clean_crime %>% select(precinct,
                                                reportedDate)
precinct_summary$year <- year(precinct_summary$reportedDate)

precinct_summary <- precinct_summary %>%
  dplyr::select(year,
                precinct) %>%
  group_by(year,
                precinct) %>%
  mutate(case = n()) %>%
  unique() %>%
  arrange(-case)

precinct_summary %>% ggplot(aes(x = precinct,
             y = case,
             colour = year)) +
  geom_point() +
  facet_wrap(~ year) +
  xlab("precinct") +
  ylab("case") +
  ggtitle("precinct summary in each year") +
  theme(legend.position = "none")
```
# Analyse of police force used
```{r force used for primary offense}
force_used_summary <- police_use_of_force %>% select(PrimaryOffense,
                                                ResponseDate,
                                                ForceType,
                                                SubjectInjury,
                                                EventAge)
force_used_summary$year <- year(force_used_summary$ResponseDate)

force_used_summary2018 <- force_used_summary %>%
  dplyr::filter(year %in% c("2018")) %>%
  group_by(PrimaryOffense) %>%
  summarise(case = n()) %>%
  distinct() %>%
  head(10)
g1 <- force_used_summary2018 %>% ggplot(aes(x=case, reorder(PrimaryOffense, case))) + 
        geom_bar(stat='identity', fill='red') +
    ggtitle("force used in 2018") +
labs(x='case2018', y='primary offence')

force_used_summary2019 <- force_used_summary %>%
  dplyr::filter(year %in% c("2019")) %>%
  group_by(PrimaryOffense) %>%
  summarise(case = n()) %>%
  distinct() %>%
  head(10)
g2 <- force_used_summary2019 %>% ggplot(aes(x=case, reorder(PrimaryOffense, case))) + 
        geom_bar(stat='identity', fill='blue') +
    ggtitle("force used in 2019") +
labs(x='case2019', y='primary offence')

force_used_summary2020 <- force_used_summary %>%
  dplyr::filter(year %in% c("2020")) %>%
  group_by(PrimaryOffense) %>%
  summarise(case = n()) %>%
  distinct() %>%
  head(10)

g3 <- force_used_summary2020 %>% ggplot(aes(x=case, reorder(PrimaryOffense, case))) + 
        geom_bar(stat='identity', fill='green') +
    ggtitle("force used in 2020") +
labs(x='case2020', y='primary offence')

grid.arrange(g1, g2, g3, ncol = 3)
```

```{r force type}
force_type_used <- force_used_summary %>%
  dplyr::filter(year %in% c("2018",
                            "2019",
                            "2020")) %>%
  group_by(ForceType,
           year) %>%
  summarise(total = n()) %>%
  distinct()

force_type_used %>% ggplot(aes(x=total, reorder(ForceType, total))) + 
        geom_bar(stat='identity') +
    facet_wrap(~ year) +
    ggtitle("force used tpye") +
labs(x='total', y='force type')
```
